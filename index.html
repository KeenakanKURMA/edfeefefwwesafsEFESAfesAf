<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Lantern Saya</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: Arial;
            overflow: hidden;
        }
        #status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div id="status">
        <h3>AR Loading...</h3>
        <div id="messages">Memulakan sistem AR</div>
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: ./targets.mind; autoStart: true; maxTrack: 4;"
        embedded
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        renderer="antialias: true;">

        <a-assets>
            <a-asset-item id="model1" src="./model1.glb"></a-asset-item>
            <a-asset-item id="model2" src="./model2.glb"></a-asset-item>
            <a-asset-item id="model3" src="./model3.glb"></a-asset-item>
            <a-asset-item id="model4" src="./model4.glb"></a-asset-item>
        </a-assets>

        <!-- Target 1 -->
        <a-entity mindar-image-target="targetIndex: 0">
            <a-entity gltf-model="#model1" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
        </a-entity>

        <!-- Target 2 -->
        <a-entity mindar-image-target="targetIndex: 1">
            <a-entity gltf-model="#model2" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
        </a-entity>

        <!-- Target 3 -->
        <a-entity mindar-image-target="targetIndex: 2">
            <a-entity gltf-model="#model3" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
        </a-entity>

        <!-- Target 4 -->
        <a-entity mindar-image-target="targetIndex: 3">
            <a-entity gltf-model="#model4" scale="0.5 0.5 0.5" position="0 0 0"></a-entity>
        </a-entity>

        <!-- Camera -->
        <a-entity camera position="0 0 0" look-controls></a-entity>
        
        <!-- Lighting -->
        <a-entity light="type: ambient; color: #CCC; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 0.8" position="-1 2 1"></a-entity>
    </a-scene>

    <script>
        const status = document.getElementById('status');
        const messages = document.getElementById('messages');
        const scene = document.querySelector('a-scene');

        // Ignore cache warnings - ini bukan error
        const originalWarn = console.warn;
        console.warn = function(...args) {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('cache')) {
                // Skip cache warnings
                return;
            }
            originalWarn.apply(console, args);
        };

        // Track loading progress
        let assetsLoaded = 0;
        const totalAssets = 5; // targets.mind + 4 models

        function updateProgress(message, isError = false) {
            messages.innerHTML += `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
            assetsLoaded++;
            
            if (assetsLoaded >= totalAssets) {
                status.innerHTML = '<h3>âœ… AR Ready!</h3><div>Scan target image dengan camera</div>';
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        // Check file availability
        async function checkFile(file) {
            try {
                const response = await fetch(file);
                if (response.ok) {
                    updateProgress(`âœ… ${file} found`);
                } else {
                    updateProgress(`âŒ ${file} missing`, true);
                }
            } catch (error) {
                updateProgress(`âŒ ${file} error: ${error.message}`, true);
            }
        }

        // Check all required files
        checkFile('./targets.mind');
        checkFile('./model1.glb');
        checkFile('./model2.glb');
        checkFile('./model3.glb');
        checkFile('./model4.glb');

        // Scene events
        scene.addEventListener('loaded', () => {
            updateProgress('âœ… AR Scene loaded successfully');
        });

        scene.addEventListener('error', (e) => {
            updateProgress(`âŒ Scene error: ${e.detail}`, true);
        });

        // MindAR events
        scene.addEventListener('mindar-target-found', (e) => {
            console.log('ðŸŽ¯ Target found:', e.target);
        });

        // Final check - hide loading if everything works
        setTimeout(() => {
            if (status.style.display !== 'none') {
                status.innerHTML = '<h3>ðŸŽ¯ AR Ready to Use!</h3><div>Camera activated - scan your target</div>';
            }
        }, 5000);
    </script>
</body>
</html>
